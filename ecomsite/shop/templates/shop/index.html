{% comment %} {% extends 'shop/base.html' %} {% endcomment %}
{%load static %}

<html>
<head>
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>   
    
</head>
<body>
    {% block body %}
    <div class="container">
        <div class = "row" style = "margin-top : 20px;">
            <div class = "row">
                <div class = "col-md-12 ">
                    <nav class="navbar navbar-expand-lg navbar-light bg-light">
                        {% comment %} <a class="navbar-brand" href="#">Navbar</a> {% endcomment %}
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                          <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                          <ul class="navbar-nav">
                            <li class="nav-item">
                                {% comment %} <a class="nav-link" href="#">Features</a> {% endcomment %}
                              <a href="{% url 'shop:index' %}" class="btn btn-warning mr-4" style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Home</a>
                              </li>
                            <li class="nav-item">
                              {% comment %} <a class="nav-link" href="#">Features</a> {% endcomment %}
                            <a href="{% url 'shop:checkout' %}" class="btn btn-warning mr-4" style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">CheckOut</a>
                            </li>
                            <li class="nav-item">
                              {% comment %} <a id = "sunny"class="btn btn-warning" style = "" href="#">Cart(0)</a> {% endcomment %}
                              <button id="sunny" type="button" class="btn btn-warning mr-4" data-toggle="popover" data-content="This is the pop-up message" style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;">
                                Cart(0)
                            </button>
                            </li>
                          </ul>
                        </div>
                      </nav>
                </div>
            </div>
        </div>
        <div class = "row" style = "margin-top : 20px;">
            <div class = "col-md-12">
                <form class = "card card-sm">
                    <div class = "card-body row no-gutters align-items-center">
                        <div class="col-auto">
                            <a href="{% url 'shop:index' %}" class= style="">
                                <img src="https://media.istockphoto.com/id/1249601382/photo/three-toy-shopping-carts-isolated-on-white-e-commerce-concept.jpg?b=1&s=170667a&w=0&k=20&c=F7d_DuJsyugoiV1yjDdYXsaieAqPmNXN2l4vNXwDdCI=" alt="Logo" width="200" height="100">
                            </a>                            
                        </div>
                        <div class = "col">
                            <input type = "search" name = "item_name" placeholder = "search for items" class = "form-control form-control-boarderless ">
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-success" type="submit" style="background-color: green;">Search</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            {% for product in product_objects %}
            <div class="col-md-4">
                <div class="card" style = "margin-top:10px ">
                    <!--Product Image-->
                    <img src="{{ product.Image }}" class="card-img-top"  alt="Product Image">
                    <div class="card-body">
                        <!--ProductTitle-->
                        <div  id = "nm{{product.id}}"class="card-title" style = "font-weight: 900;font-family: 'Lobster', cursive;">{{ product.title }}</div>
                        <!--Product Price-->
                        <div id = "price{{product.id}}"class="card-text" style="color: green; font-weight: 300; font-family: 'Lobster', cursive;">
                            {{ product.price }} cal
                        </div>
                        <!--ProductProteins-->
                        <div id = "proteins{{product.id}}"class="card-text" style="color: green; font-weight: 300; font-family: 'Lobster', cursive; visibility: hidden;">
                            {{ product.Proteins }}gm of Protein
                        </div>
                        <!--ProductFats-->
                        <div id = "fat{{product.id}}"class="card-text" style="color: green; font-weight: 300; font-family: 'Lobster', cursive; visibility: hidden;">
                            {{ product.fats }}gm of fat
                        </div>
                        <!--ProductCarbohydrates-->
                        <div id = "carbo{{product.id}}"class="card-text" style="color: green; font-weight: 300; font-family: 'Lobster', cursive; visibility: hidden;">
                            {{ product.Carbohydrates }}gm of carbs
                        </div>
                        <!--Buttons-->
                        <div class = "row">
                            <!--Viewdetails Button-->
                            <div class="col-md-6">
                                <a href="{% url 'shop:detail' id=product.id %}" class="btn btn-warning" style="background-color: green;font-weight: 300;font-family: 'Lobster', cursive;color:White;">ViewDetails</a></br>
                            </div>
                            <!--Ad to cart Button-->
                            <div class="col-md-6">
                                <button id = "{{product.id}}"class="btn atc btn-warning" style="font-weight: 300;font-family: 'Lobster', cursive;color:White;">Add to Cart</button>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
            {% endfor %}
        </div>
        <div class = "row">
            <div class = "col-md-3 offset-md-4">
                <ul  style = "margin-top : 50px;"class = "pagination">
                    <!-- Starting of Acessing the previous elements-->
                    {%if product_objects.has_previous%}
                    <li class = "page-item">
                        <a class = "page-link"href = "?page={{product_objects.previous_page_number}}">PreviousPage</a>
                    </li>
                    {% endif %}
                    <!-- ending of Acessing the previous elements-->
                    <!--Starting of Acessing the Current ELement-->

                    <!--Ending of Acessing the Current ELement-->
                    <li class = "page-item active">
                        <a class = "page-link"href = "?page={{product_objects.number}}">CurrentPage</a>
                    </li>

                    <!-- Starting of Acessing the Next elements-->
                    {%if product_objects.has_next%}
                    <li class = "page-item">
                        <a class = "page-link" href = "?page={{product_objects.next_page_number}}">NextPage</a>
                    </li>
                    {% endif %}
                    <!-- ending of Acessing the Next elements-->

                </ul>

            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

</body>
<script type = "text/javascript">
    console.log('this is working');
    

    if(localStorage.getItem('cart')==null){// this cart is from localstorage and var cart is the cart that we use in js.
        var cart = {};//here we created a varibale Cart and we use {} to store the id of the Product and quantity of the product
    }
    //if cart contains any items add that items to var cart
    else{
        //cart = localstorage.getItem('cart')
        cart = JSON.parse(localStorage.getItem('cart'));//we use JSON to parse the String and convert it into a JS Object
    }
    $(document).on('click','.atc',function(){
        console.log("The add to cart is clicked");
        var item_id = this.id.toString();
        console.log(item_id);
        //if the item already present in the cart and again when you hit add to cart it should increment
        if(cart[item_id]!=undefined){
            quantity = cart[item_id][2]+1;
            cart[item_id][2] = quantity
            cart[item_id][3] = cart[item_id][3] + parseFloat(document.getElementById("price"+item_id).innerHTML);
            cart[item_id][5] = cart[item_id][5] + parseFloat(document.getElementById("proteins"+item_id).innerHTML);
            cart[item_id][7] = cart[item_id][7] + parseFloat(document.getElementById("fat"+item_id).innerHTML);
            cart[item_id][9] = cart[item_id][9] + parseFloat(document.getElementById("carbo"+item_id).innerHTML);


            //cart[item_id]=cart[item_id]+1;
        }
        //if the item not in the cart now you are adding thaat item in to cart so we assign 1 as there is only one item
        else{
            //cart[item_id]=1;
            quantity = 1;
            name = document.getElementById("nm"+item_id).innerHTML;
            price = parseFloat(document.getElementById("price"+item_id).innerHTML);
            cost = parseFloat(document.getElementById("price"+item_id).innerHTML);
            prots = parseFloat(document.getElementById("proteins"+item_id).innerHTML);
            totalprots = parseFloat(document.getElementById("proteins"+item_id).innerHTML);
            fats = parseFloat(document.getElementById("fat"+item_id).innerHTML);
            totalfats = parseFloat(document.getElementById("fat"+item_id).innerHTML);
            carbos = parseFloat(document.getElementById("carbo"+item_id).innerHTML);
            totalcarbos = parseFloat(document.getElementById("carbo"+item_id).innerHTML);
            cart[item_id]=[name,price,quantity,cost,prots,totalprots,fats,totalfats,carbos,totalcarbos];
        }
        console.log(cart);//upto now we stored the values in var cart now we need to store the values in local storage
        localStorage.setItem('cart',JSON.stringify(cart));
        document.getElementById("sunny").innerHTML = "Cart("+Object.keys(cart).length+")"
        console.log(Object.keys(cart).length)
    });
    $(document).ready(function() {
        $('[data-toggle="popover"]').popover({
            trigger: 'hover',
            placement: 'bottom'
        });
    });
</script>
{% endblock body %}
</html>