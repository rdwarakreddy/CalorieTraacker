{% comment %} {% extends 'shop/base.html' %}  {% endcomment %}
{%load static %}

<html>
<head>
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>   
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    <div class="container">
        <div class = "row" style = "margin-top : 20px;">
            <div class = "row">
                <div class = "col-md-12 ">
                    <nav class="navbar navbar-expand-lg navbar-light bg-light">
                        <div class="collapse navbar-collapse" id="navbarNav">
                          <ul class="navbar-nav">
                            <li class="nav-item">
                                {% comment %} <a class="nav-link" href="#">Features</a> {% endcomment %}
                              <a href="{% url 'shop:index' %}" class="btn btn-warning mr-4 " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Home</a>
                              </li>
                            <li class="nav-item">
                              {% comment %} <a class="nav-link" href="#">Features</a> {% endcomment %}
                            <a href="{% url 'shop:checkout' %}" class="btn btn-warning mr-4" style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">CheckOut</a>
                            </li>
                            <li class="nav-item">
                              {% comment %} <a id = "sunny"class="btn btn-warning" style = "" href="#">Cart(0)</a> {% endcomment %}
                              <button id="sunny" type="button" class="btn btn-warning mr-4" data-toggle="popover" data-content="This is the pop-up message" style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;">
                                Cart(0)
                            </button>
                            </li>
                          </ul>
                        </div>
                      </nav>
                </div>
            </div>
        </div></br>
        {% comment %} <div class = "row" style = "margin-top : 20px;">
            <div class = "col-md-12">
                <form class = "card card-sm">
                    <div class = "card-body row no-gutters align-items-center">
                        <div class="col-auto">
                            <a href="{% url 'shop:index' %}" class= style="">
                                <img src="https://media.istockphoto.com/id/1249601382/photo/three-toy-shopping-carts-isolated-on-white-e-commerce-concept.jpg?b=1&s=170667a&w=0&k=20&c=F7d_DuJsyugoiV1yjDdYXsaieAqPmNXN2l4vNXwDdCI=" alt="Logo" width="200" height="100">
                            </a>                            
                        </div>
                        <div class = "col">
                            <input type = "search" name = "item_name" placeholder = "search for items" class = "form-control form-control-boarderless ">
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-success" type="submit" style="background-color: green;">Search</button>
                        </div>
                    </div>
                </form>
            </div>
        </div> {% endcomment %}

    {% block body %}
    <div class = "container">
        <div class = "row" style = "">
            <div class = "col-md-12">
              <table style="border-collapse: collapse; width: 120%;" class = "table">
                <thead>
                    <tr style="border-bottom: 1px solid #000;">
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Item</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Calories</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Quantity</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Protein</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Carbs</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Fat</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">TotalProteins</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">TotalFats</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">Totalcarbs</a></th>
                      <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-warning " style = "font-weight: 300;font-family: 'Lobster', cursive;color:Black;margin-right:5px;" href="#">TotalCalories</a></th>




                    </tr>
                </thead>
                <tbody id="itemlist">
                </tbody>
            </table>


            <table style="border-collapse: collapse; width: 100%;" class = "table">
              <thead>
                  <tr style="border-bottom: 1px solid #000;">
                     
                    <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-dark " style = "font-weight: 300;font-family: 'Lobster', cursive;color:white;margin-right:5px;" href="#">Total No:of Proteins</a></th>
                    <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-dark " style = "font-weight: 300;font-family: 'Lobster', cursive;color:white;margin-right:5px;" href="#">Total No:of Carbs</a></th>
                    <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-dark " style = "font-weight: 300;font-family: 'Lobster', cursive;color:white;margin-right:5px;" href="#">Total No:of Fat</a></th>
                    <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-dark " style = "font-weight: 300;font-family: 'Lobster', cursive;color:white;margin-right:5px;" href="#">Total No:of Items</a></th>
                    <th style="text-align: left; padding: 8px;"><a href="{% url 'shop:index' %}" class="btn btn-dark " style = "font-weight: 300;font-family: 'Lobster', cursive;color:white;margin-right:5px;" href="#">Total No:of Calories</a></th>
                  </tr>
              </thead>
              <tbody id="itemlist2">
              </tbody>
          </table>
            </div>
        </div></br>
        <div class = "row" style = "">
            <div class = "col-md-12">
                <form onsubmit="clearCart()">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary" style = "margin-left:1025px;">Clear</button></br>
                    <div>
                      <canvas id="myChart"></canvas>
                    </div>
                  </form>
            </div> 
    </div> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
</body>
<script type = "text/javascript">
    function clearCart() {
        localStorage.removeItem('cart');
    }
    if(localStorage.getItem('cart')==null){
        var cart={};
    }
    else{
        cart = JSON.parse(localStorage.getItem('cart'));
    }
    var names = []
    let totalcost =0;
    let totalquantity = 0;
    let totalproteins = 0;
    let totalcarbohydrates = 0;
    let totalfatss = 0;
    let totalprotsData = [];
    let totalfatsData = [];
    let totalcarbosData = [];
    for (i in cart) {
        let name = cart[i][0];
        let cost = cart[i][1];
        let quantity = cart[i][2];
        let price = cart[i][3];
        let totalprots = cart[i][5]
        let prots = cart[i][4]
        let fats = cart[i][6]
        let totalfats = cart[i][7]
        let carbos = cart[i][8]
        let totalcarbos = cart[i][9]

        totalcost = totalcost+cart[i][3]
        totalquantity = totalquantity+cart[i][2]
        totalproteins = totalproteins+cart[i][5]
        totalcarbohydrates = totalcarbohydrates+cart[i][9]
        totalfatss = totalfatss+cart[i][7]
        totalprotsData.push(totalproteins);
        totalfatsData.push(totalfats);
        totalcarbosData.push(totalcarbohydrates);
        //allprot = allprot+cart[i][5]
        //itemstring = `<li class = "list-group-item">${name}-${cost}-${quantity}-${price}</li>`
        //itemstring = `<li class = "list-group-item">${name} is <span class = "badge badge-warning badge-pill">${cost},</span> <span class = "badge badge-warning badge-pill">${quantity}</span>  ${name} is  <span class = "badge badge-success badge-pill">${price}</span></li>`
        itemstring = ` 
        <tr style="background-color: #f2f2f2;">
          <td style="text-align: left; padding: 8px; font-weight: 900;font-family: 'Lobster', cursive;color:Black;">${name}</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${cost}gm</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${quantity}</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${prots}gm</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${fats}gm</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${carbos}gm</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${totalprots}gm</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${totalfats}gm</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${totalcarbos}gm</td>
          <td style="text-align: left; padding: 8px; font-weight: 300;font-family: 'Lobster', cursive;color:Black;">${price}gm</td>




      </tr>`;
        $('#itemlist').append(itemstring);
        //$('#itemlist').append(totalsumstring);

    }
    //totalsumstring = `<li class = "list-group-item d-flex justify-content-between align-items-center "><b>TotalQuantity</b><span class = ><b>${totalquantity}<b></span></li>`
    //totalquantitystring = `<li class = "list-group-item d-flex justify-content-between align-items-center "><b>TotalCost</b><span class = ><b>${totalcost}<b></span></li>`
    //$('#itemlist').append(totalsumstring);
    totalstring = `<tr>
      <td>${totalproteins}gm</td>
      <td>${totalcarbohydrates}gm</td>
      <td>${totalfatss}gm</td>
      <td>${totalquantity}</td>
      <td>${totalcost}gm</td>
  </tr>`
    $('#itemlist2').append(totalstring);





    $('#totalquantity').val(totalquantity);
    $('#totalcost').val(totalcost);
    

    var names = Object.values(cart).map(item => item[0]);
    var namestring = names.join(' , ');

    $('#items').val(namestring);


  const ctx = document.getElementById('myChart');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Red', 'Blue', 'Yellow'],
      datasets: [{
        label: 'Prots',
        data: totalprotsData,
        borderWidth: 1
    },
    {
        label: 'Fats',
        data: totalfatsData,
        borderWidth: 1
    },
    {
        label: 'Carbos',
        data: totalcarbosData,
        borderWidth: 1
    }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %} 

</html>